<section><title> Slope Fields </title>

    <introduction>
        <p>
        Many differential equations have no explicit formula for their solutions. Even when they do, those formulas can be messy or hard to interpret. Fortunately, there's another way to understand what solutions look like — without ever solving the equation. This method is called a <term>slope field</term>.
        </p>
        <p>
        A slope field is a visual representation of the slopes that a solution curve must follow at each point in the plane. It's like a map of tiny arrows (or line segments) that show the direction a solution would travel through each point. The pattern formed by these segments gives us a picture of the <em>family of solutions</em> to the differential equation.
        </p>
    </introduction>

    <exploration><title>Comparing Slope Fields</title>
        <p>
        To get the idea, we'll compare the slope fields for three differential equations:
        </p>

        <md>
        <mrow xml:id="slope-de-a"> \amp \text{(A)} \quad \frac{dy}{dx} = \frac{y}{x} </mrow>
        <mrow xml:id="slope-de-b"> \amp \text{(B)} \quad \frac{dy}{dx} = \frac{x}{y} </mrow>
        <mrow xml:id="slope-de-c"> \amp \text{(C)} \quad \frac{dy}{dx} = y^2 </mrow>
        </md>

        <p>
        Each equation involves two variables, <m>x</m> and <m>y</m>. The independent variable is the one you control (typically on the horizontal axis), and the dependent variable is the one that changes in response.
        </p>

        <exercise><title>Identifying Variables</title>
        <statement>
            For these three differential equations, identify the independent and dependent variables.
        </statement>
        <free-response>
            <p>
            Independent variable: <fillin width="20"/> 
            Dependent variable: <fillin width="20"/>
            </p>
        </free-response>
        </exercise>

        <exercise><title>What Does <m>\frac{dy}{dx}</m> Mean?</title>
        <statement>
            In terms of the graph of a solution <m>y = y(x)</m>, what does the symbol <m>\frac{dy}{dx}</m> represent?
        </statement>
        <free-response>
            <p><fillin width="60"/></p>
        </free-response>
        </exercise>

        <p>
        Now let’s practice computing slope values for these equations at specific points. If you plug the <m>x</m> and <m>y</m> values into the right-hand side of the equation, you’ll get the slope at that point.
        </p>

        <table>
        <tabular>
            <row>
            <cell>Assigned Point</cell>
            <cell>Slope for DE (A)</cell>
            <cell>Slope for DE (B)</cell>
            <cell>Slope for DE (C)</cell>
            </row>
            <row>
            <cell><m>(1, -2)</m></cell>
            <cell><m>-2</m></cell>
            <cell><m>-\frac{1}{2}</m></cell>
            <cell><m>4</m></cell>
            </row>
            <!-- Add rows for students to fill in -->
            <row><cell><fillin width="20"/></cell><cell><fillin width="10"/></cell><cell><fillin width="10"/></cell><cell><fillin width="10"/></cell></row>
            <row><cell><fillin width="20"/></cell><cell><fillin width="10"/></cell><cell><fillin width="10"/></cell><cell><fillin width="10"/></cell></row>
            <row><cell><fillin width="20"/></cell><cell><fillin width="10"/></cell><cell><fillin width="10"/></cell><cell><fillin width="10"/></cell></row>
        </tabular>
        </table>

        <exercise><title>Understanding Slopes Visually</title>
        <statement>
            Match each kind of slope with the way it should look in your drawing:
        </statement>
        <ul>
            <li>Positive slope: Points up and to the right</li>
            <li>Negative slope: Points down and to the left</li>
            <li>Slope of 1 or -1: 45-degree angle</li>
            <li>Slope near zero: nearly horizontal</li>
            <li>Large slope: steep tilt</li>
        </ul>
        <p>Use these clues when sketching each slope segment in your slope field.</p>
        </exercise>

        <p>
        After calculating your slopes, use colored strips of paper to build a class-wide slope field. Each strip should be centered at the assigned point and tilted to match the slope.
        </p>
    </exploration>

    <exercise><title>General Solution to <m>\frac{dy}{dx} = y^2</m></title>
        <statement>
        Solve the differential equation <m>\frac{dy}{dx} = y^2</m> and find the general solution.
        </statement>
        <free-response>
        <fillin width="60"/>
        </free-response>
    </exercise>

    <exercise><title>Initial Value Problem</title>
        <statement>
        Solve the initial value problem <m>\frac{dy}{dx} = y^2</m> with <m>y(0) =</m> <fillin width="10"/>.
        </statement>
        <free-response>
        <fillin width="60"/>
        </free-response>
    </exercise>

    <exercise><title>Behavior of Solutions</title>
        <statement>
        Based on the slope field for <m>\frac{dy}{dx} = y^2</m>, what happens to the solution as <m>x</m> increases? Does it grow? Flatten out? Blow up?
        </statement>
        <free-response>
        <fillin width="60"/>
        </free-response>
    </exercise>

    <paragraphs><title>Equilibrium Solutions and Stability</title>
        <p>
        An <term>equilibrium solution</term> is a constant solution — one where <m>y(x) = c</m> for all <m>x</m>. This happens when the derivative is zero: <m>\frac{dy}{dx} = 0</m>. For an autonomous DE like <m>\frac{dy}{dx} = f(y)</m>, we find equilibrium values by solving <m>f(y) = 0</m>.
        </p>

        <exercise><title>Equilibrium of <m>\frac{dy}{dx} = y^2</m></title>
        <statement>
            Does <m>\frac{dy}{dx} = y^2</m> have any equilibrium solutions? Justify your answer.
        </statement>
        <free-response>
            <fillin width="60"/>
        </free-response>
        </exercise>

        <p>
        Now try it on a more interesting DE:
        </p>

        <me>
        \frac{dy}{dx} = y^2 - y^4
        </me>

        <exercise><title>Long-Term Behavior</title>
        <statement>
            Based on the slope field for <m>\frac{dy}{dx} = y^2 - y^4</m>, describe the long-term behavior of solutions for different starting values of <m>y(0)</m>.
        </statement>
        <free-response>
            <p><em>Example:</em> What happens when <m>y(0) = 0.5</m>? What about when <m>y(0) = 1</m> or <m>y(0) = 2</m>?</p>
            <fillin width="60"/>
        </free-response>
        </exercise>

        <exercise><title>Finding Equilibrium Points</title>
        <statement>
            Find all values of <m>y</m> for which <m>\frac{dy}{dx} = y^2 - y^4 = 0</m>. These are the equilibrium points.
        </statement>
        <free-response>
            <fillin width="60"/>
        </free-response>
        </exercise>

        <exercise><title>Classifying Equilibria</title>
        <statement>
            Classify each equilibrium point as stable, unstable, or semi-stable based on the slope field and the sign of the derivative nearby.
        </statement>
        <free-response>
            <fillin width="60"/>
        </free-response>
        </exercise>
    </paragraphs>

    <figure>

        <image width="60%">
            <description>a direction field of slope arrows and three curves following the arrows</description>
            <sageplot>
                from sage.calculus.desolvers import desolve_rk4
                t, y = var('t, y')
                f(t, y) = y^2/2 - t
                p = plot_slope_field(f, (t,-1,5), (y,-5,10), headaxislength=3, headlength=3, axes_labels=['$t$','$y(t)$'])
                p += desolve_rk4(f,y,ics=[-1,0],ivar=t,output='plot',end_points=[-1,5],thickness=3)
                p += desolve_rk4(f,y,ics=[-1,-1],ivar=t,output='plot',end_points=[-1,5],thickness=3, color = "red")
                p += desolve_rk4(f,y,ics=[-1,0.3292],ivar=t,output='plot',end_points=[-1,5],thickness=3, color = "green")
                p
            </sageplot>
        </image>

        <caption>The direction field for <m>y' = y^2/2 - t</m></caption>

    </figure>

    <figure>

        <image width="40%">
            <latex-image>
				\begin{tikzpicture}[declare function={f(\x,\y)=\x+\y;}, scale=0.8]
					\def\xmax{3} \def\xmin{-3}
					\def\ymax{3} \def\ymin{-3}
					\def\nx{10}  \def\ny{10}
					\def\arrowscale{0.4} % length of slope arrows

					% stepsize along x-axis and y-axis
					\pgfmathsetmacro{\hx}{(\xmax-\xmin)/\nx}
					\pgfmathsetmacro{\hy}{(\ymax-\ymin)/\ny}

					% Draw grid lines
					\foreach \i in {0,...,\nx} {
						\pgfmathsetmacro{\xgrid}{\xmin + \i * \hx}
						\draw[thin, gray!50] (\xgrid, \ymin) -- (\xgrid, \ymax);
					}
					\foreach \j in {0,...,\ny} {
						\pgfmathsetmacro{\ygrid}{\ymin + \j * \hy}
						\draw[thin, gray!50] (\xmin, \ygrid) -- (\xmax, \ygrid);
					}

					% slope field: just draw a vector at each point
					\foreach \i in {0,...,\nx}
					\foreach \j in {0,...,\ny}{

						\pgfmathsetmacro{\xpt}{\xmin + \i*\hx}
						\pgfmathsetmacro{\ypt}{\ymin + \j*\hy}
						\pgfmathsetmacro{\slope}{f(\xpt,\ypt)}

						% Normalize direction vector (1, slope) to fixed length
						\pgfmathsetmacro{\len}{sqrt(1 + (\slope)^2)}
						\pgfmathsetmacro{\dx}{\arrowscale / \len}
						\pgfmathsetmacro{\dy}{\arrowscale * \slope / \len}

						\draw[teal!90, -stealth, line width=1.1pt, shift={(\xpt,\ypt)}] (0,0) -- (\dx,\dy);
					}

					% Optional solution curve
					\def\yo{1}
					\draw[magenta, thick, samples=100] 
						plot[domain=\xmin:1] (\x, {(\yo + 1)*exp(\x) - \x - 1});

					% Axes
					\draw[->, thick] (\xmin - 0.5, 0) -- (\xmax + 0.5, 0) node[right] {$t$};
					\draw[->, thick] (0, \ymin - 0.5) -- (0, \ymax + 0.5) node[above] {$y$};

					% Title
					%\node[above, font=\small\bfseries] at (current bounding box.north) 
					%	{Slope field for \quad $y' = x + y$};

				\end{tikzpicture}
            </latex-image>
        </image>

        <caption>The direction field for <m>y' = y^2/2 - t</m></caption>

    </figure>

</section>
